#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ Hugo —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
# –ù–∞—Ö–æ–¥–∏—Ç –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Hugo, –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–æ—Ä—Ç 1313

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Hugo —Å–µ—Ä–≤–µ—Ä–∞..."

# –ü–æ–∏—Å–∫ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Hugo
HUGO_PIDS=$(pgrep -f "hugo server")

if [ -n "$HUGO_PIDS" ]; then
    echo "üìã –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã Hugo: $HUGO_PIDS"
    
    # –ú—è–≥–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    echo "üîÑ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Hugo..."
    kill $HUGO_PIDS 2>/dev/null
    
    # –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    sleep 3
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã
    REMAINING_PIDS=$(pgrep -f "hugo server")
    
    if [ -n "$REMAINING_PIDS" ]; then
        echo "‚ö†Ô∏è  –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
        kill -9 $REMAINING_PIDS 2>/dev/null
    fi
    
    echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å—ã Hugo –∑–∞–≤–µ—Ä—à–µ–Ω—ã"
else
    echo "‚ÑπÔ∏è  –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Hugo –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ 1313
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 1313..."
PORT_PID=$(lsof -ti:1313)

if [ -n "$PORT_PID" ]; then
    echo "üìã –ü–æ—Ä—Ç 1313 –∑–∞–Ω—è—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º: $PORT_PID"
    echo "üîÑ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ 1313..."
    kill -9 $PORT_PID 2>/dev/null
    echo "‚úÖ –ü–æ—Ä—Ç 1313 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
else
    echo "‚ÑπÔ∏è  –ü–æ—Ä—Ç 1313 —Å–≤–æ–±–æ–¥–µ–Ω"
fi

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ Hugo
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
if [ -d "resources/_gen" ]; then
    rm -rf resources/_gen
    echo "‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã"
fi

# –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–∞
if [ -f "hugo-dev.log" ]; then
    rm hugo-dev.log
    echo "‚úÖ –õ–æ–≥-—Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω"
fi

echo ""
echo "üéâ Hugo —Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã!"
echo "üí° –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ./start-dev.sh"
